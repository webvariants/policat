<?php
/*
 * Copyright (c) 2016, webvariants GmbH <?php Co. KG, http://www.webvariants.de
 *
 * This file is released under the terms of the MIT license. You can find the
 * complete text in the attached LICENSE file or online at:
 *
 * http://www.opensource.org/licenses/mit-license.php
 */

/**
 * MappingPairTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class MappingPairTable extends Doctrine_Table {

  /**
   * Returns an instance of this class.
   *
   * @return MappingPairTable
   */
  public static function getInstance() {
    return Doctrine_Core::getTable('MappingPair');
  }

  /**
   *
   * @return Doctrine_Query
   */
  public function queryByMappingId($id) {
    return $this->createQuery('p')->where('p.mapping_id = ?', $id)->orderBy('p.id');
  }

  /**
   *
   * @return Doctrine_Query
   */
  public function queryByMappingIdAndA($id, $a) {
    return $this->queryByMappingId($id)->andWhere('p.a = ?', $a);
  }

  public function getMapByIdAndA($id, $a) {
    if (!is_scalar($a))
      return array();
    $ret = array();
    foreach ($this->queryByMappingIdAndA($id, $a)->useResultCache()->execute() as $pair) {
      /* @var $pair MappingPair */
      $ret[] = $pair->getB();
    }
    return $ret;
  }

  public function getAsByMappingId($id) {
    $As = $this->queryByMappingId($id)->select('DISTINCT p.a')->execute(array(), Doctrine_Core::HYDRATE_SINGLE_SCALAR);
    if (is_string($As))
      $As = array($As);

    return $As;
  }

  public function getAsByMappingIdAndBs($id, $b) {
    $As = $this->queryByMappingId($id)->andWhereIn('p.b', $b)->orderBy('p.a')->select('DISTINCT p.a')->execute(array(), Doctrine_Core::HYDRATE_SINGLE_SCALAR);
    if (is_string($As)) {
      $As = array($As);
    }

    return $As;
  }

//  protected function fetchByMappingIdCached($id) {
//    return $this->queryByMappingId($id)->useResultCache()->fetchArray();
//  }
//
//  public function fetchMapCached($id) {
//    $map = array();
//    foreach ($this->fetchByMappingIdCached($id) as $pair) {
//      /* @var $pair MappingPair */
//      if (!array_key_exists($pair['a'], $map)) {
//        $map[$pair['a']] = array($pair['b']);
//      } else {
//        $map[$pair['a']][] = $pair['b'];
//      }
//    }
//
//    return $map;
//  }

}